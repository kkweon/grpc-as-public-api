apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: envoy
  name: envoy
spec:
  replicas: 1
  selector:
    matchLabels:
      app: envoy
  template:
    metadata:
      labels:
        app: envoy
    spec:
      containers:
        - image: envoyproxy/envoy:v1.14.1
          name: envoy
          command:
            - /usr/local/bin/envoy
          args:
            - "-c /etc/envoy/envoy.yaml"
            - "-l trace"
            - "--log-path /tmp/envoy_info.log"
          volumeMounts:
            - name: kkweon-tls
              readOnly: true
              mountPath: /etc/server

            - name: envoy-yaml
              readOnly: true
              mountPath: /etc/envoy/envoy.yaml
              subPath: envoy.yaml

          ports:
            - name: http
              containerPort: 8080
            - name: admin-http
              containerPort: 9901

      volumes:
        - name: kkweon-tls
          secret:
            secretName: kkweon-tls

        - name: envoy-yaml
          configMap:
            name: envoy-yaml
